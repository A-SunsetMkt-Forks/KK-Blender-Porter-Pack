# KK Blender Porter Pack
Plugin pack for exporting and setting up Koikatsu characters in Blender.  

The ```KKBP exporter for Koikatsu``` is used to export the character's mesh, armature and color data. The exported data is then processed by the ```KKBP plugin for Blender``` and the [CATS addon](https://github.com/GiveMeAllYourCats/cats-blender-plugin). Once characters are setup in Blender, they can also be saved as FBX files for use in other programs.   
The changelog for the pack [can be found here.](https://github.com/FlailingFog/KK-Blender-Shader-Pack/blob/master/Changelog.md)
The pack [also has a barebones wiki here.](https://github.com/FlailingFog/KK-Blender-Shader-Pack/wiki)

# Download
You can download KKBP [on the release page](https://github.com/FlailingFog/KK-Blender-Porter-Pack/releases).  
The absolute latest version can be downloaded by using the green CODE button on the top right of the page and choosing Download ZIP

# Usage Instructions for V5
### Video instructions (click for playlist)
[![ ](https://github.com/FlailingFog/KK-Blender-Shader-Pack/blob/assets/readme/playlistthumbnail.png)](https://www.youtube.com/playlist?list=PLhiuav2SCuvdEAbUzJxSqp61fNiPTFfwb)

### Text instructions (no shading instructions)

Prerequisites:
* Install [HF Patch v3.13 or later](https://github.com/ManlyMarco/KK-HF_Patch) for Koikatsu.
* Download [CATS blender plugin](https://github.com/GiveMeAllYourCats/cats-blender-plugin) for Blender

1. Download KKBP
2. Open the KKBP zip > go to the plugins folder > get the KKBP_Exporter.DLL file from KKBP_Exporter.zip
3. Go to your Koikatsu install directory > go to the BepInEx > go to the plugins folder > Place the KKBP_Exporter.DLL file into this folder
4. Start the game, go to the character creator and load your character
5. Click the "Export Model for KKBP" button on the top of the screen
6. Wait for the character to export
7. Copy the entire folder generated by the plugin to your desktop. This folder is located in "Export_PMX" in your koikatsu install directory. The format of this folder is ######_CharacterName. 
8. Open blender and install the CATS addon and the full zip repository zip file (KK-Blender-Porter-Pack-master.zip)
9. Click the Import Model button in CATS and import the .pmx file from the export folder.  
![ ](https://github.com/FlailingFog/KK-Blender-Shader-Pack/blob/assets/readme/catsimport.png)
9. Click the Finalize PMX file button. This may take a few minutes depending on your hardware. If blender crashes, disable the "Fix eyewhites" toggle before running it  
![ ](https://github.com/FlailingFog/KK-Blender-Shader-Pack/blob/assets/readme/kkpanel1.png)
10. When that finishes you should be in edit mode (light green box) with some of your hair selected. Enter face select mode on the top left (red box). You can hide the armature in the outliner by clicking the eye on the top right (dark green box). Shift + Click any face on any hair that isn't highlighted. This will highlight the face and also highlight the material the face is using on the material panel. In the screenshot, I have just shift + clicked the cf_m_hair_f_31_00 material, so it is highlighted. Once the face is highlighted, click the Select button on the material panel (yellow box). Continue this until all hair is selected. Do not select any hair accessories like hair bands or hair ties. You can undo a selection using ctrl + Z or by using the Deselect button on the material panel. ![ ](https://github.com/FlailingFog/KK-Blender-Shader-Pack/blob/assets/readme/hairselection.png)
11. When all hair is selected, press the P key to separate the hair by selection  
![ ](https://github.com/FlailingFog/KK-Blender-Shader-Pack/blob/assets/readme/hairseparate.png)
12. Rename the separated hair object in the outliner to "Hair"  
![ ](https://github.com/FlailingFog/KK-Blender-Shader-Pack/blob/assets/readme/rename.png)
13. (Optional) Separate and rename any other objects if you want (accessories, underwear, etc). 
14. Click the Import KK Shader and textures button. Choose the folder that contains the .pmx file. Your character should look black and yellow like this  
![ ](https://github.com/FlailingFog/KK-Blender-Shader-Pack/blob/assets/readme/importtemplates.png)
16. Click the Convert and Apply colors button. Choose the folder that contains the .pmx file again. Your character should have the correct colors now.  
![ ](https://github.com/FlailingFog/KK-Blender-Shader-Pack/blob/assets/readme/importcolors.png)
18. Edit the armature if you need to
19. Edit the shaders to get the exact look you want. This includes editing the detail mask intensities, hair highlights, eye scaling, dark colors etc

### Exporting Instructions
1. In the KKBP panel, choose which export type you want. There's currently a targeted export type for Unity (VRM), and a generic export type for everything else
2. Click the "Prep for target application" button
3. Select your model, click the "Bake material templates" button and choose the folder you want to store all of your baked images to (warning: there's going to be a lot, so an empty folder is recommended)
4. When it's done, click the "Apply baked templates" button and choose the same folder from step 3
5. (Optional) You can rebake any blurry materials by going back to their shader nodes, setting the final "Mix Shader" node to zero, increasing the "Bake multiplier" property on the KKBP panel and then returning to step 3
6. Go to the CATS optimization tab, generate the material list, set the layer you want each material to appear on, and click the "Save atlas to..." button. This will give you the light version of the material atlas.
7. Hit the undo button, change the "Light atlas" menu option in the KKBP panel to "Dark atlas" and repeat step 6 to get the dark version of the material atlas.
8. (Optional) Repeat step 7 for the "Normal atlas" option
9. (Optional) Generate Visemes for the model in the CATS Visemes panel. I suggest using mouth_a_big, mouth_o_big and mouth_i_big
10. (Optional) Delete any shapekeys that will not be used to reduce the size of the model file 
11. Click the export model button in the CATS main panel to get the .fbx file

